const{ArrayBuffer:e,Atomics:t,Promise:s}=globalThis,{isArray:r}=Array,{create:n,getPrototypeOf:a,values:o}=Object,c=a(Int32Array),i=n(t),p=()=>s.withResolvers();let l=0;const f=new Map,u=(e,t)=>class extends e{constructor(e,...s){super(e,...s),e instanceof t&&f.set(this,[l++,0,p()])}},d=new WeakSet,g=e=>(d.add(e),e),w=(e,t)=>{const{data:s}=e,n=r(s)&&(s.at(0)===t||0===s.at(1)&&!t);return n&&(e.stopImmediatePropagation(),e.preventDefault()),n},h=e=>null!==e&&"object"==typeof e&&!d.has(e),y=new WeakMap,v=(t,s,r)=>{if(f.has(t))s.set(t,f.get(t)[0]);else if(!(t instanceof c||t instanceof e))for(const e of o(t))h(e)&&!r.has(e)&&(r.add(e),v(e,s,r))},M=(...e)=>({value:new s((t=>{let s=new Worker("data:application/javascript,onmessage%3De%3D%3EpostMessage(!Atomics.wait(...e.data))");s.onmessage=()=>t("ok"),s.postMessage(e)}))}),m=(e,t,s)=>{for(const[s,r]of t)y.set(s,[r,e.currentTarget]);(({currentTarget:e,type:t,origin:s,lastEventId:r,source:n,ports:a},o)=>{e.dispatchEvent(new MessageEvent(t,{data:o,origin:s,lastEventId:r,source:n,ports:a}))})(e,s)};let{BigInt64Array:A,Int32Array:E,SharedArrayBuffer:k,Worker:b}=globalThis,x=e=>e;const I=e=>({...e,type:"module"});try{new k(4),b=class extends b{constructor(e,t){super(e,I(t))}},i.waitAsync||(i.waitAsync=M)}catch(t){const s=crypto.randomUUID(),r=new Map,n=new Map,a=(e,t,s,...r)=>{e.addEventListener(t,s,...r)},o=({serviceWorker:e},t,r)=>{let o;a(e,"message",(e=>{if(w(e,s)){const[t,r,a]=e.data,c=[r,a].join(","),i=e=>{n.delete(c),o.postMessage([s,r,a,e])},l=n.get(c);if(l)i(l);else{const{promise:e,resolve:t}=p();n.set(c,t),e.then(i)}}})),e.register(t).then((function e(t){o=t.installing||t.waiting||t.active,"activated"===o.state?r():a(o,"statechange",(()=>e(t)),{once:!0})}))};x=g,i.notify=(e,t)=>{const[r,a]=(e=>y.get(e))(e),o=[r,t].join(","),c=n.get(o);return c?c(e):n.set(o,e),a.postMessage([s,1,e,r,t]),0},i.waitAsync=(e,...t)=>{const[s,r]=((e,t)=>{const s=f.get(e),[r,n,{promise:a}]=s;return s[1]=t,[r,a]})(e,...t);return{value:r}},k=class extends e{},A=u(A,k),E=u(E,k),b=class extends b{constructor(e,t){let n=t?.serviceWorker||"";if(n){if(n=new URL(n,location.href).href,t={...t,serviceWorker:n},!r.has(n)){const{promise:e,resolve:t}=p();o(navigator,n,t),r.set(n,e)}r.get(n).then((()=>super.postMessage([s,3])))}super(e,I(t)),super.postMessage([s,0,t]),a(this,"message",(e=>{if(w(e,s)){const[t,s,...r]=e.data;switch(s){case 1:((e,t,s)=>{for(const[r,[n,a,{resolve:o}]]of f)if(t===n&&s===a){for(let t=0;t<e.length;t++)r[t]=e[t];f.delete(r),o("ok");break}})(...r);break;case 2:m(e,...r)}}}))}postMessage(e,...t){return super.postMessage(((e,t)=>{const s=new Map;return h(t)&&v(t,s,new Set),s.size?[e,2,s,t]:t})(s,e),...t)}}}const{BYTES_PER_ELEMENT:T}=Int32Array,{BYTES_PER_ELEMENT:W}=Uint16Array,{notify:U}=i,{entries:S}=Object,j=new TextDecoder("utf-16"),D=new WeakSet,P=(...e)=>(D.add(e),e),B=new Map;let L=0;const O=([e,t,s,r,n,a,o,c],i)=>(...p)=>{const l=L++,f=[];D.has(p.at(-1)||f)&&D.delete(f=p.pop());const u=n(o?p.map(o):p);let d=new t(new s(2*T));return r([e,2,l,d,i,u],{transfer:f}),c(d,0).value.then((()=>{const n=d[1];if(!n)return;const o=W*n;return d=new t(new s(o+o%T)),r([e,1,l,d]),c(d,0).value.then((()=>a(j.decode(new Uint16Array(d.buffer).slice(0,n)))))}))},R=(e,t)=>{const s=new Map;for(const[r,n]of S(t))s.set(r,e.push(n)-1);return s};var _=({parse:e,stringify:t,transform:s}=JSON)=>{const r=((e,t)=>async(s,r,n,a)=>{try{const o=await s(...a);if(void 0!==o){const s=e(t?t(o):o);B.set(r,s),n[1]=s.length}}finally{n[0]=1,U(n,0)}})(t,s),n=crypto.randomUUID();return{Worker:class extends b{constructor(t,a){const o=p(),c=[];super(t,a={...a,exports:R(c,a?.exports||{})}),this.proxy=new Proxy(o.promise,{get:(e,t)=>async(...s)=>(await e)[t](...s)}),this.postMessage(x([n,0,a])),this.addEventListener("message",(t=>{if(w(t,n)){const[a,p,...l]=t.data;switch(p){case 0:o.resolve(((e,t)=>{const s={};for(const[r,n]of t)s[r]=O(e,n);return s})([n,E,k,this.postMessage.bind(this),x,e,s,i.waitAsync],...l));break;case 2:{const[e,t,s,n]=l;r(c[s],e,t,n);break}case 1:((e,t)=>{const s=B.get(e);B.delete(e);for(let e=new Uint16Array(t.buffer),r=0,{length:n}=s;r<n;r++)e[r]=s.charCodeAt(r);U(t,0)})(...l)}}}))}},transfer:P}};export{_ as default};
