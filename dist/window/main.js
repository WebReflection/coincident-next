const e="symbol",t="apply",s="construct",r="defineProperty",n="deleteProperty",a="ownKeys";new FinalizationRegistry((([e,t,s])=>{s&&console.debug(`Held value ${String(t)} not relevant anymore`),e(t)}));const o=new Map,{ArrayBuffer:c,Atomics:i,Promise:l}=globalThis,{isArray:p}=Array,{create:u,getPrototypeOf:f,values:d}=Object,g=f(Int32Array),y=u(i),w=()=>l.withResolvers();let v=0;const h=new Map,m=(e,t)=>class extends e{constructor(e,...s){super(e,...s),e instanceof t&&h.set(this,[v++,0,w()])}},E=new WeakSet,M=e=>(E.add(e),e),k=(e,t)=>{const{data:s}=e,r=p(s)&&(s.at(0)===t||0===s.at(1)&&!t);return r&&(e.stopImmediatePropagation(),e.preventDefault()),r},b=e=>null!==e&&"object"==typeof e&&!E.has(e),A=new WeakMap,x=(e,t,s)=>{if(h.has(e))t.set(e,h.get(e)[0]);else if(!(e instanceof g||e instanceof c))for(const r of d(e))b(r)&&!s.has(r)&&(s.add(r),x(r,t,s))},W=(...e)=>({value:new l((t=>{let s=new Worker("data:application/javascript,onmessage%3De%3D%3EpostMessage(!Atomics.wait(...e.data))");s.onmessage=()=>t("ok"),s.postMessage(e)}))}),S=(e,t,s)=>{for(const[s,r]of t)A.set(s,[r,e.currentTarget]);(({currentTarget:e,type:t,origin:s,lastEventId:r,source:n,ports:a},o)=>{e.dispatchEvent(new MessageEvent(t,{data:o,origin:s,lastEventId:r,source:n,ports:a}))})(e,s)};let{BigInt64Array:T,Int32Array:I,SharedArrayBuffer:U,Worker:P}=globalThis,_=e=>e,j=!1;const L=e=>({...e,type:"module"});try{new U(4),P=class extends P{constructor(e,t){super(e,L(t))}},y.waitAsync||(y.waitAsync=W)}catch(e){const t=crypto.randomUUID(),s=new Map,r=(e,t,s,...r)=>{e.addEventListener(t,s,...r)},n=({serviceWorker:e},n,a)=>{let o;r(e,"message",(e=>{if(k(e,t)){const[r,n,a]=e.data,c=[n,a].join(","),i=e=>{s.delete(c),o.postMessage([t,n,a,e])},l=s.get(c);if(l)i(l);else{const{promise:e,resolve:t}=w();s.set(c,t),e.then(i)}}})),e.register(n).then((function e(t){o=t.installing||t.waiting||t.active,"activated"===o.state?a():r(o,"statechange",(()=>e(t)),{once:!0})}))};_=M,j=!0,y.notify=(e,r)=>{const[n,a]=(e=>A.get(e))(e),o=[n,r].join(","),c=s.get(o);return c?c(e):s.set(o,e),a.postMessage([t,1,e,n,r]),0},y.waitAsync=(e,...t)=>{const[s,r]=((e,t)=>{const s=h.get(e),[r,n,{promise:a}]=s;return s[1]=t,[r,a]})(e,...t);return{value:r}},U=class extends c{},T=m(T,U),I=m(I,U);let a=null;P=class extends P{constructor(e,s){let o=s?.serviceWorker||"";if(o){if(o=new URL(o,location.href).href,s={...s,serviceWorker:o},!a){const{promise:e,resolve:t}=w();n(navigator,o,t),a=e}a.then((()=>super.postMessage([t,3])))}super(e,L(s)),super.postMessage([t,0,s]),r(this,"message",(e=>{if(k(e,t)){const[t,s,...r]=e.data;switch(s){case 1:((e,t,s)=>{for(const[r,[n,a,{resolve:o}]]of h)if(t===n&&s===a){for(let t=0;t<e.length;t++)r[t]=e[t];h.delete(r),o("ok");break}})(...r);break;case 2:S(e,...r)}}}))}postMessage(e,...s){return super.postMessage(((e,t)=>{const s=new Map;return b(t)&&x(t,s,new Set),s.size?[e,2,s,t]:t})(t,e),...s)}}}const{BYTES_PER_ELEMENT:R}=Int32Array,{BYTES_PER_ELEMENT:D}=Uint16Array,{notify:B}=y,O=new TextDecoder("utf-16"),$=new WeakSet,N=(...e)=>($.add(e),e);let z="";const Y=new Map;let C=0;const F=(e,t)=>new Proxy(t,{get:(t,s)=>t.get(s)||t.set(s,(([e,t,s,r,n,a,o,c,i,l],p)=>(...u)=>{if(""!==z)throw new Error(`ðŸ’€ðŸ”’ - proxy.${p}() deadlock in proxy.${z}()`);const f=C++,d=[];$.has(u.at(-1)||d)&&$.delete(d=u.pop());const g=r(i?u.map(i):u);let y=new t(new s(2*R));return c([e,2,p,f,y,g,n],{transfer:d}),l(y,0).value.then((()=>{const r=y[1];if(!r)return;const n=D*r;return y=new t(new s(n+n%R)),c([e,1,f,y]),l(y,0).value.then((()=>{const e=new Uint16Array(y.buffer),t=o?e.subarray(0,r):e.slice(0,r);return a(O.decode(t))}))}))})(e,s)).get(s),set:(e,t,s)=>!!e.set(t,s)});var H=({parse:e,stringify:t,transform:s}=JSON)=>{const r=((e,t)=>async(s,[r,n,a,o,c])=>{c&&(z=r);try{const r=await s(...o);if(void 0!==r){const s=e(t?t(r):r);Y.set(n,s),a[1]=s.length}}finally{c&&(z=""),a[0]=1,B(a,0)}})(t,s),n=crypto.randomUUID();return{Worker:class extends P{constructor(t,a){const o=new Map;super(t,a),this.proxy=F([n,I,U,_,!1,e,j,(...e)=>this.postMessage(...e),s,y.waitAsync],o),this.postMessage(_([n,0,a])),this.addEventListener("message",(e=>{if(k(e,n)){const[t,s,...n]=e.data;switch(s){case 2:((e,t,s)=>{const[r]=s,n=t.get(r);if(!n)throw new Error(`Unknown proxy.${r}()`);e(n,s)})(r,o,n);break;case 1:((e,t)=>{const s=Y.get(e);Y.delete(e);for(let e=new Uint16Array(t.buffer),r=0,{length:n}=s;r<n;r++)e[r]=s.charCodeAt(r);B(t,0)})(...n)}}}))}},transfer:N}};Object.fromEntries(["array","bigint","boolean","function","null","number","object","string",e,"undefined"].map(((e,t)=>[e,t])));const{[a]:J}=Reflect;new Map(J(Symbol).filter((t=>typeof Symbol[t]===e)).map((e=>[Symbol[e],e])));const{[t]:K,[s]:q,[r]:G,[n]:Q}=Reflect,{addEventListener:V}=EventTarget.prototype,X=new WeakMap;G(EventTarget.prototype,"addEventListener",{value(e,t,...s){const r=s.at(0)?.invoke;if(r){let t=X.get(this);t||X.set(this,t=new Map),t.set(e,[].concat(r)),delete s[0].invoke}return V.call(this,e,t,...s)}});var Z=e=>{const a=H(e),{Worker:c}=a,i=e=>e,l=(e,t,s)=>e((e=>o.get(e))(t),...s.map(i));return{...a,Worker:class extends c{constructor(e,a){const{proxy:o}=super(e,a);o["\0__main__\0"]=(e,a,...o)=>{switch(e){case t:return l(K,a,o);case s:return l(q,a,o);case r:{const[e,t]=o,{get:s,set:r,value:n}=t;return s&&(t.get=s),r&&(t.set=r),n&&(t.value=n),G(s(a),e,t)}case n:return l(Q,a,o)}}}}}};export{Z as default};
